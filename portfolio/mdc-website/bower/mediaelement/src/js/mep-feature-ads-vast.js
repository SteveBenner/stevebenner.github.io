!function(t){t.extend(mejs.MepDefaults,{vastAdTagUrl:""}),t.extend(MediaElementPlayer.prototype,{buildvast:function(t,a,s,o){var e=this;""!=e.options.vastAdTagUrl&&e.vastLoadAdTagInfo(),e.buildads(t,a,s,o),e.vastSetupEvents()},vastAdTagIsLoading:!1,vastAdTagIsLoaded:!1,vastStartedPlaying:!1,vastAdTags:[],vastSetupEvents:function(){var t=this;t.container.on("mejsprerollstarted",function(){if(console.log("VAST","mejsprerollstarted"),t.vastAdTags.length>0){var a=t.vastAdTags[0];if(a.trackingEvents.start&&t.adsLoadUrl(a.trackingEvents.start),!a.shown&&a.impressions.length>0)for(var s=0,o=a.impressions.length;o>s;s++)t.adsLoadUrl(a.impressions[s]);a.shown=!0}}),t.container.on("mejsprerollended",function(){console.log("VAST","mejsprerollended"),t.vastAdTags.length>0&&t.vastAdTags[0].trackingEvents.complete&&t.adsLoadUrl(t.vastAdTags[0].trackingEvents.complete)})},vastSetAdTagUrl:function(t){var a=this;a.options.vastAdTagUrl=t,a.vastAdTagIsLoaded=!1,a.vastAdTags=[]},vastLoadAdTagInfo:function(){console.log("loading vast ad data");var t=this;t.adsDataIsLoading=!0,t.vastAdTagIsLoading=!0,t.loadAdTagInfoDirect()},loadAdTagInfoDirect:function(){console.log("loading vast:direct");var a=this;t.ajax({url:a.options.vastAdTagUrl,crossDomain:!0,success:function(t){console.log("vast:direct:success",t),a.vastParseVastData(t)},error:function(t){console.log("vast:direct:error",t),a.loadAdTagInfoProxy()}})},loadAdTagInfoProxy:function(){console.log("loading vast:proxy:yahoo");var a=this,s=location.protocol,o=location.hostname,e=(RegExp(s+"//"+o),'select * from xml where url="'+encodeURI(a.options.vastAdTagUrl)+'"'),r="http"+(/^https/.test(s)?"s":"")+"://query.yahooapis.com/v1/public/yql?format=xml&q="+e;t.ajax({url:r,crossDomain:!0,success:function(t){console.log("vast:proxy:yahoo:success",t),a.vastParseVastData(t)},error:function(t){console.log("vast:proxy:yahoo:error",t)}})},vastParseVastData:function(a){var s=this;s.vastAdTags=[],t(a).find("Ad").each(function(a,o){var e=t(o),r={id:e.attr("id"),title:t.trim(e.find("AdTitle").text()),description:t.trim(e.find("Description").text()),impressions:[],clickThrough:t.trim(e.find("ClickThrough").text()),mediaFiles:[],trackingEvents:{},shown:!1};s.vastAdTags.push(r),e.find("Impression").each(function(){r.impressions.push(t.trim(t(this).text()))}),e.find("Tracking").each(function(a,s){var o=t(s);r.trackingEvents[o.attr("event")]=t.trim(o.text())}),e.find("MediaFile").each(function(a,o){var e=t(o),n=e.attr("type");""!=s.media.canPlayType(n).toString().replace(/no/,"").replace(/false/,"")&&r.mediaFiles.push({id:e.attr("id"),delivery:e.attr("delivery"),type:e.attr("type"),bitrate:e.attr("bitrate"),width:e.attr("width"),height:e.attr("height"),url:t.trim(e.text())})})}),s.vastLoaded()},vastLoaded:function(){var t=this;t.vastAdTagIsLoaded=!0,t.vastAdTagIsLoading=!1,t.adsDataIsLoading=!1,t.vastStartPreroll()},vastStartPreroll:function(){console.log("vastStartPreroll");var t=this;t.vastAdTags.length>0&&t.vastAdTags[0].mediaFiles.length>0&&(t.options.adsPrerollMediaUrl=t.vastAdTags[0].mediaFiles[0].url,t.options.adsPrerollAdUrl=t.vastAdTags[0].clickThrough,t.adsStartPreroll())}})}(mejs.$);