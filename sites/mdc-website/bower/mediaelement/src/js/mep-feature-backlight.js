!function(t){function e(e,i,l,r,d,c,s){e.empty();var h=document.createElement("canvas"),g=h.getContext("2d"),f=i.width,p=i.height,b=a(i,l,d,s,"top"),u=a(i,l,d,s,"bottom"),m=a(i,l,r,s,"left"),v=a(i,l,r,s,"right"),S=[],j=0;h.width=f+c+c,h.height=p+c+c,g.globalCompositeOperation="xor",S.push(o(b[b.length-1],v[0])),S.push(o(u[u.length-1],v[v.length-1])),S.push(o(u[0],m[m.length-1])),S.push(o(b[0],m[0])),j=1/b.length,gradient=l.createLinearGradient(c,c,f+c,c),gradient.addColorStop(0,"rgb("+n(S[3]).join(",")+")");for(var k=0,y=b.length;y>k;k++)gradient.addColorStop(k*j+j/2,"rgb("+n(b[k]).join(",")+")");gradient.addColorStop(1,"rgb("+n(S[0]).join(",")+")"),g.fillStyle=gradient,g.fillRect(c,0,f,c),gradient=l.createLinearGradient(c+f,c,c+f,c+p),gradient.addColorStop(0,"rgb("+n(S[0]).join(",")+")");for(var k=0,y=v.length;y>k;k++)gradient.addColorStop(k*j+j/2,"rgb("+n(v[k]).join(",")+")");gradient.addColorStop(1,"rgb("+n(S[1]).join(",")+")"),g.fillStyle=gradient,g.fillRect(c+f,c,c+f+c,p),gradient=l.createLinearGradient(c,c+p,c+f,c+p),gradient.addColorStop(0,"rgb("+n(S[2]).join(",")+")");for(var k=0,y=u.length;y>k;k++)gradient.addColorStop(k*j+j/2,"rgb("+n(u[k]).join(",")+")");gradient.addColorStop(1,"rgb("+n(S[1]).join(",")+")"),g.fillStyle=gradient,g.fillRect(c,c+p,f,c),gradient=l.createLinearGradient(c,c,c,c+p),gradient.addColorStop(0,"rgb("+n(S[3]).join(",")+")");for(var k=0,y=m.length;y>k;k++)gradient.addColorStop(k*j+j/2,"rgb("+n(m[k]).join(",")+")");gradient.addColorStop(1,"rgb("+n(S[2]).join(",")+")"),g.fillStyle=gradient,g.fillRect(0,c,c,p),g.fillStyle="rgb("+n(S[0]).join(",")+")",g.fillRect(f+c,0,c+f+c,c),g.fillStyle="rgb("+n(S[1]).join(",")+")",g.fillRect(f+c,c+p,c+f+c,c+p+c),g.fillStyle="rgb("+n(S[2]).join(",")+")",g.fillRect(0,c+p,c,c+p+c),g.fillStyle="rgb("+n(S[3]).join(",")+")",g.fillRect(0,0,c,c),t(h).css("position","absolute").css("top",-c).css("left",-c).appendTo(e)}function i(t,e){return e.addColorStop(0,"rgba("+t.join(",")+",0)"),e.addColorStop(1,"rgba("+t.join(",")+",1)"),e}function a(t,e,i,a,o){var n,r,d=t.width,c=t.height,s="top"==o||"bottom"==o?a:Math.ceil(c/i),h="top"==o||"bottom"==o?Math.ceil(d/i):a,g=[];if("top"==o||"bottom"==o)for(r=0;i>r;r++)try{n=e.getImageData(r*h,"top"==o?0:c-s,h,s),g.push(l(n.data))}catch(f){console.log(f)}else for(r=0;i>r;r++)try{n=e.getImageData("right"==o?d-h:0,r*s,h,s),g.push(l(n.data))}catch(f){console.log(f)}return g}function o(t,e){var i=[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2];return i}function l(t){for(var e=[0,0,0],i=t.length,a=0;i>a;a+=4)e[0]+=t[a],e[1]+=t[a+1],e[2]+=t[a+2];return e[0]=Math.round(e[0]/i),e[1]=Math.round(e[1]/i),e[2]=Math.round(e[2]/i),e}function n(t){return t=r(t),t[1]=Math.min(100,1.2*t[1]),t[2]=80,d(t)}function r(t){var e,i,a,o,l,n,i,r=t[0]/255,d=t[1]/255,c=t[2]/255;return e=Math.min(Math.min(r,d),c),i=Math.max(Math.max(r,d),c),a=r==e?d-c:d==e?c-r:r-d,o=r==e?3:d==e?5:1,l=Math.floor(60*(o-a/(i-e)))%360,n=Math.floor((i-e)/i*100),i=Math.floor(100*i),[l,n,i]}function d(t){var e,i,a,o,l,n=t[0],r=t[1],d=t[2],r=r/100,d=d/100,n=n/360;if(r>0){n>=1&&(n=0),n=6*n;var c=n-Math.floor(n);switch(a=Math.round(255*d*(1-r)),o=Math.round(255*d*(1-r*c)),l=Math.round(255*d*(1-r*(1-c))),d=Math.round(255*d),Math.floor(n)){case 0:e=d,i=l,o=a;break;case 1:e=o,i=d,o=a;break;case 2:e=a,i=d,o=l;break;case 3:e=a,i=o,o=d;break;case 4:e=l,i=a,o=d;break;case 5:e=d,i=a,o=o}return[e||0,i||0,o||0]}return d=Math.round(255*d),[d,d,d]}t.extend(mejs.MepDefaults,{backlightBackground:[0,0,0],backlightHorizontalLights:5,backlightVerticalLights:5,backlightSize:50,backlightTimeout:200}),t.extend(MediaElementPlayer.prototype,{buildbacklight:function(a,o,l,n){function r(){f.drawImage(n,0,0,n.width,n.height),e(h,g,f,a.options.backlightVerticalLights,a.options.backlightHorizontalLights,a.options.backlightSize,30),p&&b&&(u=setTimeout(r,a.options.backlightTimeout))}if(a.isVideo){var d,c=a.container.find(".mejs-mediaelement").parent(),s=(t('<div class="mejs-border"></div>').prependTo(c).css("position","absolute").css("top","-10px").css("left","-10px").css("border","solid 10px #010101").width(a.width).height(a.height),t('<div class="mejs-backlight-glow"></div>').prependTo(c).css("position","absolute").css("display","none").css("top",0).css("left",0).width(a.width).height(a.height)),h=t('<div class="mejs-backlight"></div>').prependTo(c).css("position","absolute").css("top",0).css("left",0).width(a.width).height(a.height),g=document.createElement("canvas"),f=g.getContext("2d"),p=!0,b=!0,u=null,m=document.createElement("canvas"),v=m.getContext("2d"),S=a.options.backlightSize,j=a.options.backlightBackground,k=a.width,y=a.height;g.width=k,g.height=y,m.width=k+S+S,m.height=y+S+S,d=i(j,v.createLinearGradient(S,S,S,0)),v.fillStyle=d,v.fillRect(S,S,k,-S),d=i(j,v.createRadialGradient(k+S,S,0,k+S,S,S)),v.fillStyle=d,v.fillRect(k+S,S,S,-S),d=i(j,v.createLinearGradient(k+S,S,k+S+S,S)),v.fillStyle=d,v.fillRect(k+S,S,S,y),d=i(j,v.createRadialGradient(k+S,y+S,0,k+S,y+S,S)),v.fillStyle=d,v.fillRect(k+S,y+S,S,S);var d=i(j,v.createLinearGradient(S,S+y,S,S+y+S));v.fillStyle=d,v.fillRect(S,S+y,k,S),d=i(j,v.createRadialGradient(S,y+S,0,S,y+S,S)),v.fillStyle=d,v.fillRect(0,y+S,S,S),d=i(j,v.createLinearGradient(S,S,0,S)),v.fillStyle=d,v.fillRect(S,S,-S,y),d=i(j,v.createRadialGradient(S,S,0,S,S,S)),v.fillStyle=d,v.fillRect(0,0,S,S),t(m).css("position","absolute").css("top",-S).css("left",-S).appendTo(s),t('<div class="mejs-backlight-button mejs-backlight-active"><span></span></div>').appendTo(o).click(function(){b?(delete u,u=null,h.hide(),s.hide(),t(this).removeClass("mejs-backlight-active").addClass("mejs-backlight-inactive")):(r(),h.show(),s.show(),t(this).removeClass("mejs-backlight-inactive").addClass("mejs-backlight-active")),b=!b}),n.addEventListener("play",function(){b&&(p=!0,r(),s.css("display",""))},!1),n.addEventListener("pause",function(){p=!1},!1),n.addEventListener("ended",function(){p=!1},!1)}}})}(mejs.$);